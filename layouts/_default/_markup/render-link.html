<!--
  Converts local ".md" links into proper links (not supported out-of-the-box by Hugo).
  Also adds 'target="_blank"' to external links.
  Source:
  * https://github.com/bep/portable-hugo-links
  * https://github.com/bep/portable-hugo-links/blob/master/layouts/_default/_markup/render-link.html
-->
{{- $link := .Destination -}}
{{- $isExternal := strings.HasPrefix $link "http" -}}
{{- if not $isExternal -}}
  {{- $url := urls.Parse $link -}}
  {{- if $url.Path -}}
    {{- $fragment := "" -}}
    {{- with $url.Fragment -}}
      {{- $fragment = printf "#%s" . -}}
    {{- end -}}
    {{- with site.GetPage $url.Path -}}
      {{- $link = printf "%s%s" .RelPermalink $fragment -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
<a href="{{ $link | safeURL }}"{{ with .Title}} title="{{ . }}"{{ end }}{{ if $isExternal }} target="_blank"{{ end }}>{{ .Text | safeHTML }}</a>